<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Zlibrary.Noproxy.Maui.Views.BookSearchView"
             Title="图书搜索">
    <ScrollView>
        <VerticalStackLayout Padding="10" Spacing="10">
            <!-- 搜索区域 -->
            <Border Stroke="LightGray" StrokeThickness="1" Padding="10">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Z-Library 图书搜索" FontSize="18" FontAttributes="Bold" />
                    <HorizontalStackLayout Spacing="10">
                        <Entry x:Name="SearchBox" 
                               Text="{Binding SearchKeyword}" 
                               Placeholder="请输入搜索关键词" 
                               WidthRequest="300"
                               HorizontalOptions="Start"
                               />
                        <Button Text="搜索" 
                                Command="{Binding SearchBooksCommand}" 
                                IsEnabled="{Binding !IsSearching}"
                                WidthRequest="80" />
                    </HorizontalStackLayout>
                    <Label Text="{Binding SearchMessage}" 
                           TextColor="{Binding IsSearching, Converter={StaticResource BoolToColorConverter}}" />
                </VerticalStackLayout>
            </Border>

            <!-- 搜索结果区域 -->
            <Border Stroke="LightGray" StrokeThickness="1" Padding="10">
                <VerticalStackLayout Spacing="10">
                    <HorizontalStackLayout HorizontalOptions="End" Spacing="10">
                        <Button Text="刷新" 
                                Command="{Binding RefreshSearchCommand}" 
                                IsEnabled="{Binding !IsSearching}" />
                        <Button Text="上一页" 
                                Command="{Binding PreviousPageCommand}" 
                                IsEnabled="{Binding HasPreviousPage}" />
                        <Label Text="{Binding CurrentPage}" VerticalOptions="Center" />
                        <Button Text="下一页" 
                                Command="{Binding NextPageCommand}" 
                                IsEnabled="{Binding HasNextPage}" />
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Border>

            <!-- 书籍列表 -->
            <CollectionView ItemsSource="{Binding SearchResults}" 
                            SelectedItem="{Binding SelectedBook}"
                            SelectionMode="Single">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Stroke="LightGray" StrokeThickness="0,0,0,1" Padding="5">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <VerticalStackLayout Grid.Column="0" Spacing="2">
                                    <Label Text="{Binding Title}" FontAttributes="Bold" />
                                    <HorizontalStackLayout Spacing="10">
                                        <Label Text="{Binding Author}" TextColor="Gray" />
                                        <Label Text="{Binding Year}" TextColor="Gray" />
                                        <Label Text="{Binding Extension}" TextColor="Gray" />
                                        <Label Text="{Binding FileSize}" TextColor="Gray" />
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>
                                <Button Grid.Column="1" Text="下载" 
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type local:Views.BookSearchView}}, Path=BindingContext.DownloadBookCommand}"
                                        CommandParameter="{Binding}" />
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- 底部信息 -->
            <Label Text="提示：点击书籍列表中的&quot;下载&quot;按钮开始下载书籍" 
                   TextColor="Gray" 
                   FontAttributes="Italic" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>