<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             xmlns:vm="clr-namespace:Zlibrary.Noproxy.Avalonia.ViewModels"
             x:Class="Zlibrary.Noproxy.Avalonia.Views.BookSearchView"
             x:DataType="vm:BookSearchViewModel">
    <ScrollViewer>
        <Grid Margin="10" MinWidth="300">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            
            <!-- 搜索区域 -->
            <Border Grid.Row="0" 
                    BorderBrush="{DynamicResource ThemeBorderMidColor}" 
                    BorderThickness="1" 
                    CornerRadius="5" 
                    Padding="10" 
                    Margin="0,0,0,10">
                <StackPanel Orientation="Vertical">
                    <TextBlock Text="Z-Library 图书搜索" 
                               FontSize="18" 
                               FontWeight="Bold" 
                               Margin="0,0,0,10" 
                               Foreground="{DynamicResource ThemePrimaryBrush}" />
                    
                    <StackPanel Orientation="Vertical" Margin="0,0,0,10">
                        <TextBox Name="SearchBox" 
                                 Text="{Binding SearchKeyword}" 
                                 Watermark="请输入搜索关键词" 
                                 Margin="0,0,0,10"
                                 KeyDown="SearchBox_KeyDown" />
                        
                        <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Left">
                            <Button Content="搜索" 
                                    Command="{Binding SearchBooksCommand}" 
                                    IsEnabled="{Binding !IsSearching}"
                                    Background="{DynamicResource ThemePrimaryBrush}"
                                    Foreground="{DynamicResource ThemeForegroundBrush}"
                                    MinWidth="80" />
                            <Button Content="刷新" 
                                    Command="{Binding RefreshSearchCommand}" 
                                    IsEnabled="{Binding !IsSearching}"
                                    Background="{DynamicResource ThemePrimaryBrush}"
                                    Foreground="{DynamicResource ThemeForegroundBrush}"
                                    MinWidth="80" />
                        </StackPanel>
                    </StackPanel>
                    
                    <TextBlock Text="{Binding SearchMessage}" 
                               Foreground="{DynamicResource ThemeSecondaryBrush}"
                               FontSize="13"
                               FontWeight="SemiBold"
                               TextWrapping="Wrap" />
                </StackPanel>
            </Border>
            
            <!-- 分页控制区域 -->
            <Border Grid.Row="1" 
                    BorderBrush="{DynamicResource ThemeBorderMidColor}" 
                    BorderThickness="1" 
                    CornerRadius="5" 
                    Padding="10" 
                    Margin="0,0,0,10">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="10">
                    <Button Content="上一页" 
                            Command="{Binding PreviousPageCommand}" 
                            IsEnabled="{Binding HasPreviousPage}"
                            Background="{DynamicResource ThemePrimaryBrush}"
                            Foreground="{DynamicResource ThemeForegroundBrush}"
                            MinWidth="70" />
                    
                    <Border Background="{DynamicResource ThemePrimaryBrush}" 
                            CornerRadius="12" 
                            Padding="12,4"
                            VerticalAlignment="Center">
                        <TextBlock Text="{Binding CurrentPageDisplay}" 
                                   Foreground="{DynamicResource ThemeForegroundBrush}" 
                                   FontWeight="Bold"
                                   HorizontalAlignment="Center" />
                    </Border>
                    
                    <Button Content="下一页" 
                            Command="{Binding NextPageCommand}" 
                            IsEnabled="{Binding HasNextPage}"
                            Background="{DynamicResource ThemePrimaryBrush}"
                            Foreground="{DynamicResource ThemeForegroundBrush}"
                            MinWidth="70" />
                </StackPanel>
            </Border>
            
            <!-- 书籍列表 -->
            <Border Grid.Row="2" 
                    BorderBrush="{DynamicResource ThemeBorderMidColor}" 
                    BorderThickness="1" 
                    CornerRadius="5" 
                    Padding="5" 
                    Margin="0,0,0,10">
                <ListBox ItemsSource="{Binding SearchResults}" 
                         SelectedItem="{Binding SelectedBook}"
                         BorderThickness="0"
                         Background="Transparent">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border BorderBrush="{DynamicResource ThemeBorderMidColor}" 
                                    BorderThickness="0,0,0,1" 
                                    Padding="8" 
                                    Margin="2">
                                <Grid ColumnDefinitions="*,Auto">
                                    <StackPanel Grid.Column="0" Orientation="Vertical" Margin="0,0,10,0">
                                        <TextBlock Text="{Binding Title}" 
                                                   FontWeight="Bold" 
                                                   FontSize="15" 
                                                   Margin="0,0,0,5"
                                                   TextWrapping="Wrap" 
                                                   MaxLines="2"/>
                                        
                                        <StackPanel Orientation="Vertical" Spacing="3">
                                            <StackPanel Orientation="Horizontal" Spacing="10">
                                                <TextBlock Text="作者: " FontWeight="SemiBold" FontSize="12" />
                                                <TextBlock Text="{Binding Author}" Foreground="Gray" FontSize="12" />
                                            </StackPanel>
                                            
                                            <StackPanel Orientation="Horizontal" Spacing="10">
                                                <TextBlock Text="年份: " FontWeight="SemiBold" FontSize="12" />
                                                <TextBlock Text="{Binding Year}" Foreground="Gray" FontSize="12" />
                                                
                                                <TextBlock Text="格式: " FontWeight="SemiBold" FontSize="12" Margin="10,0,0,0" />
                                                <TextBlock Text="{Binding Extension}" Foreground="Gray" FontSize="12" />
                                            </StackPanel>
                                            
                                            <StackPanel Orientation="Horizontal" Spacing="10">
                                                <TextBlock Text="大小: " FontWeight="SemiBold" FontSize="12" />
                                                <TextBlock Text="{Binding FileSize}" Foreground="Gray" FontSize="12" />
                                            </StackPanel>
                                            
                                            <StackPanel Orientation="Horizontal" Spacing="10">
                                                <TextBlock Text="出版社: " FontWeight="SemiBold" FontSize="12" />
                                                <TextBlock Text="{Binding Publisher}" Foreground="Gray" FontSize="12" />
                                            </StackPanel>
                                            
                                            <StackPanel Orientation="Horizontal" Spacing="10">
                                                <TextBlock Text="语言: " FontWeight="SemiBold" FontSize="12" />
                                                <TextBlock Text="{Binding Language}" Foreground="Gray" FontSize="12" />
                                            </StackPanel>
                                        </StackPanel>
                                    </StackPanel>
                                    
                                    <Button Grid.Column="1" 
                                            Content="下载" 
                                            Command="{Binding $parent[UserControl].DataContext.DownloadBookCommand}"
                                            CommandParameter="{Binding}"
                                            Background="{DynamicResource ThemePrimaryBrush}"
                                            Foreground="{DynamicResource ThemeForegroundBrush}"
                                            MinWidth="60"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Right" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Border>
            
            <!-- 底部信息 -->
            <TextBlock Grid.Row="3" 
                       Text="提示：点击书籍列表中的“下载”按钮开始下载书籍" 
                       Foreground="Gray" 
                       FontStyle="Italic"
                       FontSize="12"
                       HorizontalAlignment="Center"
                       TextWrapping="Wrap"
                       TextAlignment="Center" />
        </Grid>
    </ScrollViewer>
</UserControl>